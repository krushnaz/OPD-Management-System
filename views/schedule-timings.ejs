<!DOCTYPE html> 
<html lang="en">
	
<!-- doccure/doctor-dashboard.html  30 Nov 2019 04:12:03 GMT -->
<head>
		<meta charset="utf-8">
		<title>OPD Management System - Doctor</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
		
		<!-- Favicons -->
		<link href="img/favicon.png" rel="icon">
		
		<!-- Bootstrap CSS -->
		<link rel="stylesheet" href="css/bootstrap.min.css">
		
		<!-- Fontawesome CSS -->
		<link rel="stylesheet" href="plugins/fontawesome/css/fontawesome.min.css">
		<link rel="stylesheet" href="plugins/fontawesome/css/all.min.css">
		
		<!-- Main CSS -->
		<link rel="stylesheet" href="css/style.css">

		<!-- Icon css -->
		<link rel="stylesheet" href="/admin/assets/css/feathericon.min.css">
		
		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
			<script src="js/html5shiv.min.js"></script>
			<script src="js/respond.min.js"></script>
		<![endif]-->
	
	</head>
	<body>

		<!-- Main Wrapper -->
		<div class="main-wrapper">
		
			<!-- Header -->
			<header class="header">
				<nav class="navbar navbar-expand-lg header-nav">
					<div class="navbar-header">
						<a id="mobile_btn" href="javascript:void(0);">
							<span class="bar-icon">
								<span></span>
								<span></span>
								<span></span>
							</span>
						</a>
						<a href="/doctor-dashboard" class="navbar-brand logo">
							<h3>OPD Management System</h3>
							<!-- <img src="img/logo.png" class="img-fluid" alt="Logo"> -->
						</a>
					</div>
					<div class="main-menu-wrapper">
						<div class="menu-header">
							<a href="/doctor-dashboard" class="menu-logo">
								<img src="img/logo.png" class="img-fluid" alt="Logo">
							</a>
							<a id="menu_close" class="menu-close" href="javascript:void(0);">
								<i class="fas fa-times"></i>
							</a>
						</div>
						<ul class="main-nav">
							<li>
							</li>
							
							<li class="login-link">
								<a href="/login">Login / Signup</a>
							</li>
						</ul>	 
					</div>		 
					<ul class="nav header-navbar-rht">
						
						</li>
						
						<!-- User Menu -->
						<li class="nav-item dropdown has-arrow logged-item">
							<a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown">
								<span class="user-img">
									<img class="rounded-circle" src="<%=doctor.image%>" width="31" alt="<%=doctor.name%>">
								</span>
							</a>
							<div class="dropdown-menu dropdown-menu-right">
								<div class="user-header">
									<div class="avatar avatar-sm">
										<img src="<%=doctor.image%>" alt="User Image" class="avatar-img rounded-circle">
									</div>
									<div class="user-text">
										<h6><%=doctor.name%></h6>
										<p class="text-muted mb-0">Doctor</p>
									</div>
								</div>
								<a class="dropdown-item" href="/doctor-dashboard">Dashboard</a>
								<a class="dropdown-item" href="/doctor-profile-settings">Profile Settings</a>
								<a class="dropdown-item" href="/logout">Logout</a>
							</div>
						</li>
						<!-- /User Menu -->
						
					</ul>
				</nav>
			</header>
			<!-- /Header -->
			
			<!-- Page Content -->
			<div class="content">
				<div class="container-fluid">
					<!-- Display error messages -->
					<% if (error && error.length > 0) { %>
						<div class="alert alert-danger alert-dismissible fade show" role="alert">
							<%= error[0] %>
							<button type="button" class="close" data-dismiss="alert" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
					<% } %>

					<!-- Display success messages -->
					<% if (success && success.length > 0) { %>
						<div class="alert alert-success alert-dismissible fade show" role="alert">
							<%= success[0] %>
							<button type="button" class="close" data-dismiss="alert" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
					<% } %>
					<div class="row">
						<div class="col-md-5 col-lg-4 col-xl-3 theiaStickySidebar">
						
							<!-- Profile Sidebar -->
							<div class="profile-sidebar">
								<div class="widget-profile pro-widget-content">
									<div class="profile-info-widget">
										<a href="#" class="booking-doc-img">
											<img src="<%=doctor.image%>" alt="User Image">
										</a>
										<div class="profile-det-info">
											<h3><%=doctor.name%></h3>
											<div class="patient-details">
												<h5 class="mb-0">
													<% if (doctor.education && doctor.education.length > 0) { %>
														<%= doctor.education[0].degree %>
													<% } %>
												</h5>
											</div>
										</div>
									</div>
								</div>
								<div class="dashboard-widget">
									<nav class="dashboard-menu">
										<ul>
											<li>
												<a href="/doctor-dashboard">
													<i class="fas fa-columns"></i>
													<span>Dashboard</span>
												</a>
											</li>
												
											<li>
												<a href="/appointments">
													<i class="fas fa-calendar-check"></i>
													<span>Appointments</span>
												</a>
											</li>

											<li>
												<a href="/my-patients">
													<i class="fas fa-user-injured"></i>
													<span>My Patients</span>
												</a>
											</li>

											<li class="active">
												<a href="/schedule-timings">
													<i class="fas fa-hourglass-start"></i>
													<span>Schedule Timings</span>
												</a>
											</li>
										
											
											<li>
												<a href="/doctor-profile-settings">
													<i class="fas fa-user-cog"></i>
													<span>Profile Settings</span>
												</a>
											</li>
											
											<li>
												<a href="/doctor-change-password">
													<i class="fas fa-lock"></i>
													<span>Change Password</span>
												</a>
											</li>
											<li>
												<a href="/logout">
													<i class="fas fa-sign-out-alt"></i>
													<span>Logout</span>
												</a>
											</li>
										</ul>
									</nav>
								</div>
							</div>
							<!-- /Profile Sidebar -->
							
						</div>
						
						<div class="col-md-7 col-lg-8 col-xl-9">
							<div class="col-md-12 col-12">
								<h2 class="breadcrumb-title">Schedule Timings</h2>
							</div>
							<div class="row">
								<div class="col-sm-12">
									<div class="card">
										<div class="card-body">
											<h4 class="card-title">Schedule Timings</h4>
											<div class="profile-box">
												<div class="row">

													<!-- <div class="col-lg-4">
														
													</div> -->

												</div>     
												<div class="row">
													<div class="col-md-12">
														<div class="card schedule-widget mb-0">
														
															<!-- Schedule Header -->
															<!-- <div class="schedule-header">
															
															</div> -->
															<!-- /Schedule Header -->
															
															<!-- Schedule Content -->
															<div class="tab-content schedule-cont">
															

																<!-- Monday Slot -->
																<div id="slot_monday" class="tab-pane fade show active">
																	<h4 class="card-title d-flex justify-content-between">
																		<span>Time Slots</span> 
																		<a class="edit-link" data-toggle="modal" href="#add_time_slot"><i class="fa fa-edit mr-1"></i>Add Time Slot</a>
																	</h4>
																</div>

															</div>
															<!-- /Schedule Content -->
															<table class="table table-hover my-3">
																<thead>
																	<tr>
																	  <th scope="col">Sr. No</th>
																	  <th scope="col">Date</th>
																	  <th scope="col">Time Duration</th>
																	  <th scope="col">Start Time</th>
																	  <th scope="col">End Time</th>
																	  <th scope="col">Status</th>
																	  <th scope="col">Action</th>
																	</tr>
																  </thead>
																  <tbody class="">
																	<% 
																		// Sort the timeSchedules array by date in ascending order
																		timeSchedules.sort((a, b) => new Date(a.date) - new Date(b.date)).forEach((schedule, index) => { 
																	%>
																		<tr class="align-middle">
																			<td><%= index + 1 %></td>
																			<td><%= schedule.date.toLocaleDateString('en-GB') %></td>
																			<td><%= schedule.slotDuration %> Mins</td>
																			<td><%= schedule.startTime %></td>
																			<td><%= schedule.endTime %></td>
																			<td>
																				<% if (schedule.status === 'book') { %>
																					<span class="badge badge-pill bg-success">Booked</span>
																				<% } else { %>
																					<span class="badge badge-pill bg-success-light">Available</span>
																				<% } %>
																			</td>
																			<td>
																				<a class="btn btn-sm bg-success-light" data-toggle="modal" href="#edit_time_slot<%=schedule._id%>">
																					<i class="fe fe-pencil"></i> Edit
																				</a>
																				<a data-toggle="modal" href="#delete_modal<%=schedule._id%>" class="btn btn-sm bg-danger-light">
																					<i class="fe fe-trash"></i> Delete
																				</a>
																			</td>
																		</tr>
																	<% }); %>
																</tbody>
																
															</table>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
								
						</div>
					</div>
					
				</div>

				
				
			</div>		
			<!-- /Page Content -->
   
			<!-- Footer -->
			<footer class="footer">
				
				
				
				<!-- Footer Bottom -->
                <div class="footer-bottom">
					<div class="container-fluid">
					
						<!-- Copyright -->
						<div class="copyright">
							
						
						</div>
						<!-- /Copyright -->
						
					</div>
				</div>
				<!-- /Footer Bottom -->
				
			</footer>
			<!-- /Footer -->
		   
		</div>
		<!-- /Main Wrapper -->
		
		<!-- Add Time Slot Modal -->
		<div class="modal fade custom-modal" id="add_time_slot">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Add Time Slots</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<form action="/schedule-time" method="post">
							<div class="hours-info">
								<div class="row form-row hours-cont">
									<div class="col-12 col-md-10">
										<div class="row form-row">
											<div class="col-12 col-md-6">
												<div class="form-group">               
													<label>Date</label>
													<input type="date" name="date" id="scheduleDate" required>
												</div>
											</div>
											<div class="col-12 col-md-6">
												<div class="form-group">               
													<label>Timing Slot Duration</label>
													<select name="slotDuration" class="select form-control" required>
														<option value="15">15 mins</option>
														<option value="30">30 mins</option>  
														<option value="45">45 mins</option>
														<option value="60">1 Hour</option>
													</select>
												</div>
											</div>
											<div class="col-12 col-md-6">
												<div class="form-group">
													<label>Start Time</label>
													<input type="time" name="startTime" id="startTime" required>
												</div> 
											</div>
											<div class="col-12 col-md-6">
												<div class="form-group">
													<label>End Time</label>
													<input type="time" name="endTime" id="endTime" required>
												</div> 
											</div>
										</div>
									</div>
								</div>
							</div>
							
							<!-- <div class="add-more mb-3">
								<a href="javascript:void(0);" class="add-hours"><i class="fa fa-plus-circle"></i> Add More</a>
							</div> -->
							<div class="submit-section text-center">
								<button type="submit" class="btn btn-primary submit-btn">Add</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
		<!-- /Add Time Slot Modal -->
		
		<!-- Edit Time Slot Modal -->
		<% timeSchedules.forEach((schedule, index) => { %>
		<div class="modal fade custom-modal" aria-hidden="true" id="edit_time_slot<%=schedule._id%>">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Edit Time Slots</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<form action="/edit-schedule-time/<%=schedule._id%>" method="post">
							<div class="hours-info">
								<div class="row form-row hours-cont">
									<div class="col-12 col-md-10">
										<div class="row form-row">
											<div class="col-12 col-md-6">
												<div class="form-group">               
													<label>Date</label>
													<%
														const formattedDate = schedule.date.toISOString().split('T')[0];
													%>
													<input type="date" name="date" value="<%= formattedDate %>" id="scheduleDate" required>
												</div>
											</div>
											<div class="col-12 col-md-6">
												<div class="form-group">               
													<label>Timing Slot Duration</label>
													<select name="slotDuration" class="select form-control" required>
														<option value="<%=schedule.slotDuration%>"><%=schedule.slotDuration%> Mins</option>
														<option value="15">15 mins</option>
														<option value="30">30 mins</option>  
														<option value="45">45 mins</option>
														<option value="60">1 Hour</option>
													</select>
												</div>
											</div>
											<div class="col-12 col-md-6">
												<div class="form-group">
													<label>Start Time</label>
													<input type="time" name="startTime" id="startTime" required>
												</div> 
											</div>
											<div class="col-12 col-md-6">
												<div class="form-group">
													<label>End Time</label>
													<input type="time" name="endTime" id="endTime" required>
												</div> 
											</div>
										</div>
									</div>
								</div>
							</div>
							
							<!-- <div class="add-more mb-3">
								<a href="javascript:void(0);" class="add-hours"><i class="fa fa-plus-circle"></i> Add More</a>
							</div> -->
							<div class="submit-section text-center">
								<button type="submit" class="btn btn-primary submit-btn">Add</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
		<% }); %>
		<!-- /Edit Time Slot Modal -->

		<!-- Delete Modal -->
		<% timeSchedules.forEach((schedule, index) => { %>
			<div class="modal fade" id="delete_modal<%=schedule._id%>" aria-hidden="true" role="dialog">
				<div class="modal-dialog modal-dialog-centered" role="document" >
					<div class="modal-content">

						<div class="modal-body">
							<div class="form-content p-2">
								<form action="/delete-schedule/<%=schedule._id%>" method="post">
								<h4 class="modal-title">Delete</h4>
								<p class="mb-4">Are you sure want to delete?</p>
								<p class="small">Be careful while deleting the schedule because all booked appointment with also get deleted.</p>
								<button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
									<button type="submit" class="btn btn-danger">Delete</button>
								</form>
							</div>
						</div>
					</div>	
				</div>
			</div>
			<% }) %>
			<!-- /Delete Modal -->
	  
		<!-- jQuery -->
		<script src="js/jquery.min.js"></script>
		
		<!-- Bootstrap Core JS -->
		<script src="js/popper.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		
		<!-- Sticky Sidebar JS -->
        <script src="plugins/theia-sticky-sidebar/ResizeSensor.js"></script>
        <script src="plugins/theia-sticky-sidebar/theia-sticky-sidebar.js"></script>
		
		<!-- Select2 JS -->
		<script src="plugins/select2/js/select2.min.js"></script>
		
		<!-- Custom JS -->
		<script src="js/script.js"></script>
		
	</body>

	<!-- JavaScript code to set the min attribute -->
<script>
    // Get today's date
    const today = new Date();
    
    // Convert it to the format required by the date input field (YYYY-MM-DD)
    const yyyy = today.getFullYear();
    let mm = today.getMonth() + 1; // January is 0, so we add 1
    let dd = today.getDate();
    if (mm < 10) {
        mm = '0' + mm; // Ensure mm is two digits
    }
    if (dd < 10) {
        dd = '0' + dd; // Ensure dd is two digits
    }
    const currentDate = yyyy + '-' + mm + '-' + dd;
    
    // Set the min attribute of the date input field to today's date
    document.getElementById('scheduleDate').min = currentDate;

</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get references to the start time and end time input fields
        const startTimeInput = document.getElementById('startTime');
        const endTimeInput = document.getElementById('endTime');

        // Add an event listener to the form for form submission
        document.querySelector('form').addEventListener('submit', function(event) {
            // Get the current system time
            const currentTime = new Date();

            // Get the selected date from the form
            const selectedDate = new Date(document.getElementById('scheduleDate').value);

            // Get the selected start time and end time from the input fields
            const startTime = new Date(`${selectedDate.toDateString()} ${startTimeInput.value}`);
            const endTime = new Date(`${selectedDate.toDateString()} ${endTimeInput.value}`);

            // Check if the start time is greater than the current system time
            if (startTime <= currentTime) {
                alert('Start time must be greater than the current time.');
                event.preventDefault(); // Prevent form submission
                return;
            }

            // Check if the end time is less than 11:59 PM on the selected date
            const endOfDay = new Date(selectedDate);
            endOfDay.setHours(23, 59, 0, 0); // Set time to 11:59 PM
            if (endTime >= endOfDay) {
                alert('End time must be less than 11:59 PM on the selected date.');
                event.preventDefault(); // Prevent form submission
                return;
            }

            // Check if the end time is at least 1 hour after the start time
            const timeDifference = endTime.getTime() - startTime.getTime(); // Time difference in milliseconds
            const minimumTimeDifference = 60 * 60 * 1000; // 1 hour in milliseconds
            if (timeDifference < minimumTimeDifference) {
                alert('End time must be at least 1 hour after the start time.');
                event.preventDefault(); // Prevent form submission
                return;
            }
        });
    });
</script>


<!-- doccure/schedule-timings.html  30 Nov 2019 04:12:09 GMT -->
</html>